(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c4b77396"],{"4ec5":function(e,t,a){"use strict";var i=a("bbcf"),r=a("143c").indexOf,n=a("c534"),o=a("e9a9"),c=[].indexOf,s=!!c&&1/[1].indexOf(1,-0)<0,u=n("indexOf"),l=o("indexOf",{ACCESSORS:!0,1:0});i({target:"Array",proto:!0,forced:s||!u||!l},{indexOf:function(e){return s?c.apply(this,arguments)||0:r(this,e,arguments.length>1?arguments[1]:void 0)}})},"82d1":function(e,t,a){},"8dea":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("layout-box",{attrs:{one:e.$route.query.id?"编辑活动":"新增活动"}},[a("el-form",{ref:"ruleForm",attrs:{"label-width":"100px",size:"small",model:e.activity,rules:e.rules}},[a("el-form-item",{attrs:{label:"活动名称：",prop:"name"}},[a("el-input",{model:{value:e.activity.name,callback:function(t){e.$set(e.activity,"name",t)},expression:"activity.name"}})],1),a("el-form-item",{attrs:{label:"活动时间：",prop:"activityBeginTime"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.activityTime,callback:function(t){e.activityTime=t},expression:"activityTime"}})],1),a("el-form-item",{attrs:{label:"活动背景图："}},[a("el-upload",{attrs:{action:"http-request","http-request":e.onUpload,"list-type":"picture-card","on-remove":e.onRemove,"file-list":e.activity.background,limit:1,multiple:""}},[a("i",{staticClass:"el-icon-plus"})])],1),a("el-form-item",{attrs:{label:"角标："}},[a("el-upload",{attrs:{action:"http-request","http-request":e.onUploadIcon,"list-type":"picture-card","on-remove":e.onRemoveIcon,"file-list":e.activity.icon,limit:1,multiple:""}},[a("i",{staticClass:"el-icon-plus"})])],1),a("el-form-item",{attrs:{label:"是否显示在页面上：",prop:"scope"}},[a("el-radio",{attrs:{label:0},model:{value:e.activity.shopModule,callback:function(t){e.$set(e.activity,"shopModule",t)},expression:"activity.shopModule"}},[e._v("否")]),a("el-radio",{attrs:{label:1},model:{value:e.activity.shopModule,callback:function(t){e.$set(e.activity,"shopModule",t)},expression:"activity.shopModule"}},[e._v("是")])],1),a("el-form-item",{attrs:{label:"适用范围：",prop:"scope"}},[a("el-radio-group",{on:{change:e.onSource},model:{value:e.activity.scope,callback:function(t){e.$set(e.activity,"scope",t)},expression:"activity.scope"}},[a("el-radio",{attrs:{label:"0"}},[e._v("所有商城")]),a("el-radio",{attrs:{label:"2"}},[e._v("所有小超")]),a("el-radio",{attrs:{label:"4"}},[e._v("平台")]),a("el-radio",{attrs:{label:"5"}},[e._v("自营店铺")])],1)],1),e.activity.scope?a("el-form-item",{attrs:{label:"活动分类：",prop:"type"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.activity.type,callback:function(t){e.$set(e.activity,"type",t)},expression:"activity.type"}},e._l(e.activityType,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.type}})})),1)],1):e._e(),e.activity.scope?a("el-form-item",{attrs:{label:"活动适用对象：",prop:"rules"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.activity.rules,callback:function(t){e.$set(e.activity,"rules",t)},expression:"activity.rules"}},e._l(e.couponRules,(function(e){return a("el-option",{key:e.id,attrs:{label:e.ruleName,value:e.rules}})})),1)],1):e._e()],1)],1),1===e.activity.type?a("el-card",{staticClass:"goods_ground"},[a("activity-add-cmp",{attrs:{activityScope:e.activity.scope,activityData:e.activityData},on:{onSubmit:e.onCouponsSubmit,onSave:e.onCouponsSave}})],1):2===e.activity.type?a("el-card",{staticClass:"goods_ground"},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[e._v("选择的商品")])]),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.goodsList,size:"mini"}},[a("el-table-column",{attrs:{prop:"name",label:"名称","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"原价",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{size:"mini"},model:{value:t.row.produPrice,callback:function(a){e.$set(t.row,"produPrice",a)},expression:"slot.row.produPrice"}},[a("template",{slot:"append"},[e._v("元")])],2)]}}])}),a("el-table-column",{attrs:{label:"活动价格",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{size:"mini"},model:{value:t.row.activePrice,callback:function(a){e.$set(t.row,"activePrice",a)},expression:"slot.row.activePrice"}},[a("template",{slot:"append"},[e._v("元")])],2)]}}])}),a("el-table-column",{attrs:{label:"需要几人成功",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{size:"mini"},model:{value:t.row.clustersNumber,callback:function(a){e.$set(t.row,"clustersNumber",a)},expression:"slot.row.clustersNumber"}},[a("template",{slot:"append"},[e._v("人")])],2)]}}])}),a("el-table-column",{attrs:{label:"活动持续时间",width:"350"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"goods_time"},[a("el-input",{attrs:{size:"mini"},on:{input:function(a){return e.onActiveTime(t)}},model:{value:t.row.activeTimeDay,callback:function(a){e.$set(t.row,"activeTimeDay",a)},expression:"slot.row.activeTimeDay"}},[a("template",{slot:"append"},[e._v("天")])],2),a("el-input",{attrs:{size:"mini"},on:{input:function(a){return e.onActiveTime(t)}},model:{value:t.row.activeTimeHour,callback:function(a){e.$set(t.row,"activeTimeHour",a)},expression:"slot.row.activeTimeHour"}},[a("template",{slot:"append"},[e._v("时")])],2),a("el-input",{attrs:{size:"mini"},on:{input:function(a){return e.onActiveTime(t)}},model:{value:t.row.activeTimeMin,callback:function(a){e.$set(t.row,"activeTimeMin",a)},expression:"slot.row.activeTimeMin"}},[a("template",{slot:"append"},[e._v("分")])],2)],1)]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.onDelete(t)}}},[e._v("删除")])]}}])})],1),a("div",{staticClass:"add",on:{click:function(t){e.addGoodsVisible=!0}}},[a("i",{staticClass:"el-icon-plus"}),a("span",[e._v("添加商品类目")])]),e.$route.query.id?a("el-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("保存")]):a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("添加")])],1):e._e(),a("addGoods-cmp",{attrs:{addGoodsVisible:e.addGoodsVisible},on:{close:e.onClose,selectGoods:e.onSelectGoods}}),a("image-compressor-cmp",{ref:"imageCompressorCmp"})],1)},r=[],n=(a("51d7"),a("5cff"),a("4ec5"),a("957b"),a("b4e6"),a("1e6a"),a("6a22"),a("5f89"),a("dcd4"),a("d211")),o=(a("6a61"),a("2e91")),c=a("1b00"),s=a("ce89"),u=a("d901"),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{fullscreen:"",title:"商品列表",visible:e.dialogTableVisible},on:{"update:visible":function(t){e.dialogTableVisible=t},close:e.onClose}},[a("el-table",{attrs:{data:e.goodsList,size:"small"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{property:"name",label:"名称"}})],1),a("el-pagination",{staticClass:"mt-1 text-right",attrs:{background:"","current-page":e.queryInit.pageNo,"page-sizes":[10,20,30,40],"page-size":e.queryInit.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.queryInit.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),a("el-button",{on:{click:e.onAdd}},[e._v("添加")])],1)},p=[],d={name:"addGoodsCmp",props:["addGoodsVisible"],data:function(){return{goodsList:[],dialogTableVisible:!1,queryInit:{pageNo:1,pageSize:10,total:0},selectGoodsList:[]}},watch:{addGoodsVisible:function(e){this.dialogTableVisible=e,this.apiProductQuery()}},created:function(){},methods:{onClose:function(){this.$emit("close")},handleSizeChange:function(e){this.queryInit.pageSize=e,this.apiProductQuery()},handleCurrentChange:function(e){console.log(e),this.queryInit.pageNo=e,this.apiProductQuery()},handleSelectionChange:function(e){this.selectGoodsList=e},onAdd:function(){this.$emit("selectGoods",this.selectGoodsList),this.onClose()},apiProductQuery:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=Object(n["a"])({},e.queryInit),t.next=3,e.$http.post(e.$api.productQuery,a);case 3:i=t.sent,e.goodsList=i.data.data.list,e.queryInit=i.data.data,e.queryInit.pageNo=i.data.data.pageNum;case 7:case"end":return t.stop()}}),t)})))()}}},m=d,v=a("5d22"),y=Object(v["a"])(m,l,p,!1,null,"18953668",null),g=y.exports,f={name:"admMarketingActivitiesAdd",components:{LayoutBox:c["a"],addGoodsCmp:g,activityAddCmp:s["a"],imageCompressorCmp:u["a"]},mixins:[],data:function(){return{activity:{name:"",activityBeginTime:"",activityEndTime:"",scope:"",type:"",rules:"",background:[],icon:[],shopModule:0},rules:{name:[{required:!0,message:"请输入活动名称",trigger:"blur"}],activityBeginTime:[{required:!0,message:"请选择活动时间",trigger:"change"}],scope:[{required:!0,message:"请选择适用范围",trigger:"change"}],type:[{required:!0,message:"请选择活动分类",trigger:"change"}],rules:[{required:!0,message:"请选择适用对象",trigger:"change"}]},activityTime:[],goodsList:[],activityType:[],couponRules:[],addGoodsVisible:!1,activityData:{}}},watch:{activityTime:function(e){this.activity.activityBeginTime=e[0],this.activity.activityEndTime=e[1]}},created:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$route.query.id){t.next=3;break}return t.next=3,e.apiGetActivityDetail();case 3:case"end":return t.stop()}}),t)})))()},methods:{onSubmit:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e._formValidate()){t.next=6;break}return a={activity:e.activity,activityPointBuys:e.goodsList},t.next=4,e.$http.post(e.$api.insertPointBuyProduct,a);case 4:i=t.sent,i.data.success?(e.$message.success("添加成功"),e.$router.go(-1)):e.$message.error(i.data.msg);case 6:case"end":return t.stop()}}),t)})))()},onSave:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e._formValidate()){t.next=8;break}a={activity:e.activity,activityPointBuys:e.goodsList},a=JSON.parse(JSON.stringify(a));try{a.activity.background=e.activity.background[0].url,a.activity.icon=e.activity.icon[0].url}catch(r){a.activity.background="",a.activity.icon="",console.error("手动抛出错误在除了卡劵需要背景图之外")}return t.next=6,e.$http.post(e.$api.updatePointBuyProduct,a);case 6:i=t.sent,i.data.success?(e.$message.success("添加成功"),e.$router.go(-1)):e.$message.error(i.data.msg);case 8:case"end":return t.stop()}}),t)})))()},onClose:function(){this.addGoodsVisible=!1},onSelectGoods:function(e){var t=this,a=this.goodsList.map((function(e){return e.produId}));e.forEach((function(e){a.indexOf(e.id)<0&&(e.produId=e.id,e.id="",t.goodsList.push(e))}))},onActiveTime:function(e){e.row.activeTime="".concat(e.row.activeTimeDay||0,"天").concat(e.row.activeTimeHour||0,"时").concat(e.row.activeTimeMin||0,"分")},onDelete:function(e){this.goodsList.splice(e.$index,1)},onSource:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.activity.type="",a.next=3,t.apiGetActivPageParam(e);case 3:case"end":return a.stop()}}),a)})))()},onCouponsSubmit:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$refs.ruleForm.validate(function(){var a=Object(o["a"])(regeneratorRuntime.mark((function a(i){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!i){a.next=11;break}e=Object(n["a"])(Object(n["a"])({},e),{},{activity:t.activity}),e=JSON.parse(JSON.stringify(e));try{e.activity.background=t.activity.background[0].url,e.activity.icon=t.activity.icon[0].url}catch(o){console.error("手动抛出错误在除了卡劵需要背景图之外")}return console.log("data",e),a.next=7,t.$http.post(t.$api.insertActivity,e);case 7:r=a.sent,r.data.success?(t.$message.success("添加成功"),t.$router.go(-1)):t.$message.error(r.data.msg),a.next=12;break;case 11:return a.abrupt("return",!1);case 12:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}());case 2:case"end":return a.stop()}}),a)})))()},onCouponsSave:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$refs.ruleForm.validate(function(){var a=Object(o["a"])(regeneratorRuntime.mark((function a(i){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!i){a.next=9;break}e=Object(n["a"])(Object(n["a"])({},e),{},{activity:t.activity});try{e.activity.background=t.activity.background[0].url,e.activity.icon=t.activity.icon[0].url}catch(o){console.error("手动抛出错误在除了卡劵需要背景图之外")}return a.next=5,t.$http.post(t.$api.updateCouponActivity,e);case 5:r=a.sent,r.data.success?(t.$message.success("保存成功"),t.$router.go(-1)):t.$message.error(r.data.msg),a.next=10;break;case 9:return a.abrupt("return",!1);case 10:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}());case 2:case"end":return a.stop()}}),a)})))()},onUpload:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var i,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=e.file,r="image/jpeg"===i.type||"image/png"===i.type,r){a.next=5;break}return t.$message.error("上传的图标只能是 JPG/PNG 格式!"),a.abrupt("return");case 5:return a.next=7,t.apiUpload(i);case 7:case"end":return a.stop()}}),a)})))()},onRemove:function(e,t){this.activity.background=[]},onUploadIcon:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var i,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=e.file,r="image/jpeg"===i.type||"image/png"===i.type,r){a.next=5;break}return t.$message.error("上传的图标只能是 JPG/PNG 格式!"),a.abrupt("return");case 5:return a.next=7,t.apiUploadIcon(i);case 7:case"end":return a.stop()}}),a)})))()},onRemoveIcon:function(e,t){this.activity.icon=[]},apiGetActivPageParam:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$http.get("".concat(t.$api.activityGetActivPageParam,"?scope=").concat(e));case 2:i=a.sent,t.activityType=i.data.data.activityTypes,t.couponRules=i.data.data.activityRules;case 5:case"end":return a.stop()}}),a)})))()},apiGetActivityDetail:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("".concat(e.$api.getActivityDetail,"?activeId=").concat(e.$route.query.id,"&type=").concat(e.$route.query.type));case 2:a=t.sent,t.t0=a.data.data.activity.type,t.next=2===t.t0?6:1===t.t0?8:10;break;case 6:return e.goodsList=a.data.data.activityPointBuys.map((function(e){return e.name=e.produName,e.activeTimeDay=e.activeTime.split("天")[0],e.activeTimeHour=e.activeTime.split("天")[1].split("时")[0],e.activeTimeMin=e.activeTime.split("天")[1].split("时")[1].split("分")[0],e})),t.abrupt("break",11);case 8:return e.activityData=a.data.data,t.abrupt("break",11);case 10:return t.abrupt("break",11);case 11:return e.activity=a.data.data.activity,a.data.data.activity.background?e.activity.background=[{url:a.data.data.activity.background}]:e.activity.background=[],a.data.data.activity.icon?e.activity.icon=[{url:a.data.data.activity.icon}]:e.activity.icon=[],t.next=16,e.apiGetActivPageParam(e.activity.scope);case 16:e.activityTime.push(a.data.data.activity.activityBeginTime),e.activityTime.push(a.data.data.activity.activityEndTime);case 18:case"end":return t.stop()}}),t)})))()},_formValidate:function(){var e=this,t=!1;return 0===this.goodsList.length?(this.$message.error("请选择商品"),t):(this.goodsList.map((function(t){if(""===t.activeTime||void 0===t.activeTime||""===t.clustersNumber||void 0===t.clustersNumber||""===t.activePrice||void 0===t.activePrice||""===t.produPrice||void 0===t.produPrice)throw e.$message.error("请填写完整"),SyntaxError("请填写完整")})),this.$refs.ruleForm.validate((function(e){if(!e)return!1;t=!0})),t)},apiUpload:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$refs.imageCompressorCmp._imageCompressor(e);case 2:i=a.sent,t.$http.post("/common/oss/uploadFile",i).then((function(e){e.data.success?t.activity.background.push({url:e.data.data.webUrl}):t.$message.error(e.data.msg)}));case 4:case"end":return a.stop()}}),a)})))()},apiUploadIcon:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$refs.imageCompressorCmp._imageCompressor(e);case 2:i=a.sent,t.$http.post("/common/oss/uploadFile",i).then((function(e){e.data.success?t.activity.icon.push({url:e.data.data.webUrl}):t.$message.error(e.data.msg)}));case 4:case"end":return a.stop()}}),a)})))()}}},b=f,h=(a("eed1"),Object(v["a"])(b,i,r,!1,null,"7de9a8e4",null));t["default"]=h.exports},eed1:function(e,t,a){"use strict";a("82d1")}}]);
//# sourceMappingURL=chunk-c4b77396.b47e9c55.js.map