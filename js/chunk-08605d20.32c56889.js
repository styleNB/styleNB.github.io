(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-08605d20"],{a937:function(e,o,t){"use strict";t.d(o,"a",(function(){return n})),t.d(o,"e",(function(){return a})),t.d(o,"d",(function(){return u})),t.d(o,"c",(function(){return r})),t.d(o,"b",(function(){return c}));t("4318"),t("957b"),t("b4e6"),t("6a22"),t("2e4f"),t("80cf");var n={methods:{addAll:function(){for(var e=0,o=0,t=0;t<this.$refs.AddGoodsCmp.$data.multipleSelection.length;t++)this.goodsAndActivity.includes(this.$refs.AddGoodsCmp.$data.multipleSelection[t])?o++:(e++,this.$refs.AddGoodsCmp.$data.multipleSelection[t].prodId=this.$refs.AddGoodsCmp.$data.multipleSelection[t].id,this.$refs.AddGoodsCmp.$data.multipleSelection[t].id="",this.goodsAndActivity.push(this.$refs.AddGoodsCmp.$data.multipleSelection[t]));0!==o&&this.$notify.error({title:"错误",message:"有".concat(o,"个重复了")}),0!==e&&(this.$message.success("有".concat(e,"个添加成功")),this.dialogVisible=!1)},handleCurrentChange:function(){},onOldUpdate:function(e){this.oldUpdateIndex=e.$index},onUpdate:function(e){this.updateIndex=e.$index},onOldSave:function(){this.oldUpdateIndex=""},onSave:function(e){this.updateIndex=""},onDelete:function(e){this.goodsAndActivity.splice(e.$index,1)},onAddGoods:function(){this.dialogVisible=!0}}},u={methods:{uploadFile:function(e){var o=this._uploadFile(e);if(o)return this.$http.post("/common/oss/uploadFile",o).then((function(e){return e.data.data.webUrl}))},_uploadFile:function(e){var o="image/jpeg"===e.file.type||"image/png"===e.file.type,t=e.file.size/1024/1024<10;if(!o)return this.$message.error("上传头像图片只能是 JPG/PNG 格式!"),!1;if(!t)return this.$message.error("上传头像图片大小不能超过 10MB!"),!1;var n=new FormData;return n.append("file",e.file),n}}},a={methods:{_validationNumber:function(e){return e=e.replace(/[^\d.]/g,""),e=e.replace(/^\./g,""),e=e.replace(/\.{2,}/g,"."),e=e.replace(".","$#$").replace(/\./g,"").replace("$#$","."),e},_verifyNumber:function(e){return e=e.replace(/[^\d]/g,""),e},_validationMoney:function(e){return e=e.replace(/[^\d.]/g,""),e=e.replace(/^0\d+|^\./g,""),e=e.replace(/\.{2,}/g,"."),e=e.replace(".","$#$"),e=e.replace(/\./g,""),e=e.replace("$#$","."),e=e.replace(/^(\d+)\.(\d\d).*$/,"$1.$2"),e}}},r={methods:{addAll:function(){for(var e=0,o=0,t=0;t<this.$refs.AddGoodsCmp.$data.multipleSelection.length;t++)this.goodsAndActivity.includes(this.$refs.AddGoodsCmp.$data.multipleSelection[t])?o++:(e++,this.$refs.AddGoodsCmp.$data.multipleSelection[t].samllProdId=this.$refs.AddGoodsCmp.$data.multipleSelection[t].id,this.goodsAndActivity.push(this.$refs.AddGoodsCmp.$data.multipleSelection[t]));0!==o&&this.$notify.error({title:"错误",message:"有".concat(o,"个重复了")}),0!==e&&(this.$message.success("有".concat(e,"个添加成功")),this.dialogVisible=!1)},handleCurrentChange:function(){},onOldUpdate:function(e){this.oldUpdateIndex=e.$index},onUpdate:function(e){this.updateIndex=e.$index},onOldSave:function(){this.oldUpdateIndex=""},onSave:function(e){this.updateIndex=""},onDelete:function(e){this.goodsAndActivity.splice(e.$index,1)},onAddGoods:function(){this.dialogVisible=!0}}},c={methods:{_export2Excel:function(e,o,n){var u=this;Promise.resolve().then(function(){var a=t("4bf8"),r=a.export_json_to_excel,c=u.formatJson(n,e);r(o,c,"统计")}.bind(null,t)).catch(t.oe)},formatJson:function(e,o){return o.map((function(o){return e.map((function(e){return o[e]}))}))}}}},b4e6:function(e,o,t){"use strict";var n=t("bbcf"),u=t("5501"),a=t("285a"),r=t("5152"),c=t("529d"),i=t("5c1e"),s=t("7389"),p=t("780c"),l=t("e9a9"),d=p("splice"),m=l("splice",{ACCESSORS:!0,0:0,1:2}),f=Math.max,v=Math.min,h=9007199254740991,y="Maximum allowed length exceeded";n({target:"Array",proto:!0,forced:!d||!m},{splice:function(e,o){var t,n,p,l,d,m,g=c(this),w=r(g.length),b=u(e,w),N=arguments.length;if(0===N?t=n=0:1===N?(t=0,n=w-b):(t=N-2,n=v(f(a(o),0),w-b)),w+t-n>h)throw TypeError(y);for(p=i(g,n),l=0;l<n;l++)d=b+l,d in g&&s(p,l,g[d]);if(p.length=n,t<n){for(l=b;l<w-n;l++)d=l+n,m=l+t,d in g?g[m]=g[d]:delete g[m];for(l=w;l>w-n+t;l--)delete g[l-1]}else if(t>n)for(l=w-n;l>b;l--)d=l+n-1,m=l+t-1,d in g?g[m]=g[d]:delete g[m];for(l=0;l<t;l++)g[l+b]=arguments[l+2];return g.length=w-n+t,p}})},ce89:function(e,o,t){"use strict";var n=function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",[t("el-form",{ref:"couponNewDtosCouponRules",attrs:{"label-width":"150px",size:"small",model:e.couponNewDtos[0].coupon,rules:e.couponNewDtosCouponRules}},[t("el-form-item",{attrs:{label:"选择商品："}},[t("el-select",{staticStyle:{width:"300px"},attrs:{multiple:"",filterable:"",placeholder:"请输入关键词"},model:{value:e.activityProductsProdId,callback:function(o){e.activityProductsProdId=o},expression:"activityProductsProdId"}},e._l(e.options,(function(e){return t("el-option",{key:e.value.id,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"优惠券名：",prop:"couponName"}},[t("el-input",{model:{value:e.couponNewDtos[0].coupon.couponName,callback:function(o){e.$set(e.couponNewDtos[0].coupon,"couponName",o)},expression:"couponNewDtos[0].coupon.couponName"}})],1),t("el-form-item",{attrs:{label:"活动结束优惠券是否可以继续使用："}},[t("el-radio",{attrs:{label:0},model:{value:e.couponNewDtos[0].coupon.activityEndUse,callback:function(o){e.$set(e.couponNewDtos[0].coupon,"activityEndUse",o)},expression:"couponNewDtos[0].coupon.activityEndUse"}},[e._v("否")]),t("el-radio",{attrs:{label:1},model:{value:e.couponNewDtos[0].coupon.activityEndUse,callback:function(o){e.$set(e.couponNewDtos[0].coupon,"activityEndUse",o)},expression:"couponNewDtos[0].coupon.activityEndUse"}},[e._v("是")])],1),t("el-form-item",{attrs:{label:"用户一次可领取数量：",prop:"availableNum"}},[t("el-input",{on:{input:function(o){return e.couponNewDtos[0].coupon.availableNum=e._verifyNumber(o)}},model:{value:e.couponNewDtos[0].coupon.availableNum,callback:function(o){e.$set(e.couponNewDtos[0].coupon,"availableNum",o)},expression:"couponNewDtos[0].coupon.availableNum"}},[t("template",{slot:"append"},[e._v("张")])],2)],1),t("el-form-item",{attrs:{label:"优惠券有效时间：",prop:"couponBeginTime"}},[t("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.couponTime,callback:function(o){e.couponTime=o},expression:"couponTime"}})],1),t("el-form-item",{attrs:{label:"优惠券总数量：",prop:"couponCount"}},[t("el-input",{on:{input:function(o){return e.couponNewDtos[0].coupon.couponCount=e._verifyNumber(o)}},model:{value:e.couponNewDtos[0].coupon.couponCount,callback:function(o){e.$set(e.couponNewDtos[0].coupon,"couponCount",o)},expression:"couponNewDtos[0].coupon.couponCount"}},[t("template",{slot:"append"},[e._v("张")])],2)],1),t("el-form-item",{attrs:{label:"优惠券类型：",prop:"couponType"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:e.couponNewDtos[0].coupon.couponType,callback:function(o){e.$set(e.couponNewDtos[0].coupon,"couponType",o)},expression:"couponNewDtos[0].coupon.couponType"}},e._l(e.couponTypes,(function(e){return t("el-option",{key:e.id,attrs:{label:e.typeName,value:e.type}})})),1)],1),t("el-form-item",{attrs:{label:"是否可叠加使用："}},[t("el-radio",{attrs:{label:0},model:{value:e.couponNewDtos[0].coupon.overlay,callback:function(o){e.$set(e.couponNewDtos[0].coupon,"overlay",o)},expression:"couponNewDtos[0].coupon.overlay"}},[e._v("否")]),t("el-radio",{attrs:{label:1},model:{value:e.couponNewDtos[0].coupon.overlay,callback:function(o){e.$set(e.couponNewDtos[0].coupon,"overlay",o)},expression:"couponNewDtos[0].coupon.overlay"}},[e._v("是")])],1)],1),t("el-form",{attrs:{"label-width":"150px",size:"small"}},[0===e.couponNewDtos[0].coupon.couponType?t("el-form-item",{attrs:{label:"金额：",required:""}},[t("el-input",{on:{input:function(o){return e.couponNewDtos[0].couponGeneral.money=e._validationMoney(o)}},model:{value:e.couponNewDtos[0].couponGeneral.money,callback:function(o){e.$set(e.couponNewDtos[0].couponGeneral,"money",o)},expression:"couponNewDtos[0].couponGeneral.money"}},[t("template",{slot:"append"},[e._v("元")])],2)],1):e._e(),1===e.couponNewDtos[0].coupon.couponType?t("el-form-item",{attrs:{label:"减免的金额：",required:""}},[t("el-input",{on:{input:function(o){return e.couponNewDtos[0].couponFullReduction.money=e._validationMoney(o)}},model:{value:e.couponNewDtos[0].couponFullReduction.money,callback:function(o){e.$set(e.couponNewDtos[0].couponFullReduction,"money",o)},expression:"couponNewDtos[0].couponFullReduction.money"}},[t("template",{slot:"append"},[e._v("元")])],2)],1):e._e(),1===e.couponNewDtos[0].coupon.couponType?t("el-form-item",{attrs:{label:"需要满的金额：",required:""}},[t("el-input",{on:{input:function(o){return e.couponNewDtos[0].couponFullReduction.fullAmount=e._validationMoney(o)}},model:{value:e.couponNewDtos[0].couponFullReduction.fullAmount,callback:function(o){e.$set(e.couponNewDtos[0].couponFullReduction,"fullAmount",o)},expression:"couponNewDtos[0].couponFullReduction.fullAmount"}},[t("template",{slot:"append"},[e._v("元")])],2)],1):e._e(),2===e.couponNewDtos[0].coupon.couponType?t("el-form-item",{attrs:{label:"卡劵商品价格：",required:""}},[t("el-input",{on:{input:function(o){return e.couponNewDtos[0].couponCard.cardMoney=e._validationMoney(o)}},model:{value:e.couponNewDtos[0].couponCard.cardMoney,callback:function(o){e.$set(e.couponNewDtos[0].couponCard,"cardMoney",o)},expression:"couponNewDtos[0].couponCard.cardMoney"}},[t("template",{slot:"append"},[e._v("元")])],2)],1):e._e(),t("el-form-item",[e._isEmpty(e.activityData)?t("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("提交")]):t("el-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("保存")])],1)],1)],1)},u=[],a=(t("51d7"),t("957b"),t("1e6a"),t("5e68"),t("6a61"),t("2e91")),r=t("a937"),c={mixins:[r["e"]],props:{activityData:{type:Object,default:function(){return{}}},activityScope:{type:String,default:""}},data:function(){return{activityProducts:[],couponNewDtos:[{coupon:{activityEndUse:0,availableNum:"",couponBeginTime:"",couponEndTime:"",couponCount:"",couponName:"",couponType:"",overlay:0},couponGeneral:{money:""},couponFullReduction:{fullAmount:"",money:""},couponCard:{cardMoney:""}}],couponNewDtosCouponRules:{couponCount:[{required:!0,message:"请输入优惠券总数量",trigger:"blur"}],couponName:[{required:!0,message:"请输入优惠券名",trigger:"blur"}],couponType:[{required:!0,message:"请选择优惠券类型",trigger:"change"}],availableNum:[{required:!0,message:"请输入用户一次可领取数量",trigger:"blur"}],couponBeginTime:[{required:!0,message:"请选择优惠券有效时间",trigger:"change"}]},activityTime:[],couponTime:[],activityProductsProdId:"",options:[],loading:!1,couponRules:[],couponTypes:[]}},watch:{couponTime:function(e,o){this.couponNewDtos[0].coupon.couponBeginTime=e[0],this.couponNewDtos[0].coupon.couponEndTime=e[1]},activityProductsProdId:function(e,o){this.activityProducts=e.map((function(e){return{prodId:e}}))}},created:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return console.log(e.activityData),o.next=3,e.apiGetGoodsList();case 3:return o.next=5,e.apiGetActivPageParam();case 5:e._isEmpty(e.activityData)||(e.activityProductsProdId=e.activityData.activityProducts.map((function(e){return e.prodId})),e.couponNewDtos=e.activityData.couponNewDtos,e.couponTime.push(e.couponNewDtos[0].coupon.couponBeginTime),e.couponTime.push(e.couponNewDtos[0].coupon.couponEndTime));case 6:case"end":return o.stop()}}),o)})))()},methods:{onSubmit:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function o(){var t,n;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:t=!1,e.$refs.couponNewDtosCouponRules.validate((function(e){t=!!e})),o.t0=e.couponNewDtos[0].coupon.couponType,o.next=0===o.t0?5:1===o.t0?7:2===o.t0?12:19;break;case 5:return""===e.couponNewDtos[0].couponGeneral.money&&e.$message.error("金额不能为空"),o.abrupt("break",19);case 7:if(""!==e.couponNewDtos[0].couponFullReduction.money){o.next=9;break}return o.abrupt("return",e.$message.error("减免的金额不能为空"));case 9:if(""!==e.couponNewDtos[0].couponFullReduction.fullAmount){o.next=11;break}return o.abrupt("return",e.$message.error("需要满的金额不能为空"));case 11:return o.abrupt("break",19);case 12:if(""!==e.couponNewDtos[0].couponCard.cardMoney){o.next=14;break}return o.abrupt("return",e.$message.error("卡劵商品价格不能为空"));case 14:if(!(e.activityProducts.length<1)){o.next=16;break}return o.abrupt("return",e.$message.error("商品不能为空"));case 16:if(!(e.activityProducts.length>3)){o.next=18;break}return o.abrupt("return",e.$message.error("商品不能超过3个"));case 18:return o.abrupt("break",19);case 19:t&&(n={activityProducts:e.activityProducts,couponNewDtos:e.couponNewDtos},e.$emit("onSubmit",n));case 20:case"end":return o.stop()}}),o)})))()},onSave:function(){var e=!1;switch(this.$refs.couponNewDtosCouponRules.validate((function(o){e=!!o})),this.couponNewDtos[0].coupon.couponType){case 0:""===this.couponNewDtos[0].couponGeneral.money&&this.$message.error("金额不能为空");break;case 1:if(""===this.couponNewDtos[0].couponFullReduction.money)return this.$message.error("减免的金额不能为空");if(""===this.couponNewDtos[0].couponFullReduction.fullAmount)return this.$message.error("需要满的金额不能为空");break;case 2:if(""===this.couponNewDtos[0].couponCard.cardMoney)return this.$message.error("卡劵商品价格不能为空");if(this.activityProducts.length<1)return this.$message.error("商品不能为空");if(this.activityProducts.length>3)return this.$message.error("商品不能超过3个");break}if(e){var o={activityProducts:this.activityProducts,couponNewDtos:this.couponNewDtos};this.$emit("onSave",o)}},apiGetGoodsList:function(e){var o=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={type:1,pageNo:1,pageSize:9999,loginName:"18556882462"},Object.assign(n,{name:e}),t.next=4,o.$http.post("woho/product/head/query",n);case 4:u=t.sent,u.data.success?o.options=u.data.data.list.map((function(e){return{value:e.id,label:e.name}})):o.$message.error(u.data.msg);case 6:case"end":return t.stop()}}),t)})))()},apiGetActivPageParam:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function o(){var t;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,e.$http.get("".concat(e.$api.activityGetActivPageParam,"?scope=").concat(e.activityScope));case 2:t=o.sent,e.couponRules=t.data.data.activityRules,e.couponTypes=t.data.data.couponTypes;case 5:case"end":return o.stop()}}),o)})))()},apiUpload:function(e){var o=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o.$refs.imageCompressorCmp._imageCompressor(e);case 2:n=t.sent,o.$http.post("/common/oss/uploadFile",n).then((function(e){e.data.success?o.couponNewDtos[0].couponCard.background.push({url:e.data.data.webUrl}):o.$message.error(e.data.msg)}));case 4:case"end":return t.stop()}}),t)})))()},_isEmpty:function(e){return""===e||("null"===e||("undefined"===e||(!e&&0!==e&&""!==e||(!(!Array.prototype.isPrototypeOf(e)||0!==e.length)||!(!Object.prototype.isPrototypeOf(e)||0!==Object.keys(e).length)))))}}},i=c,s=t("5d22"),p=Object(s["a"])(i,n,u,!1,null,"2702e197",null);o["a"]=p.exports}}]);
//# sourceMappingURL=chunk-08605d20.32c56889.js.map